<div class="bg-white rounded-lg shadow mt-6">
  <div *ngIf="!selectedDepartmentName" class="p-8 text-center text-gray-500">
    Select a department to view its staff members
  </div>

  <div *ngIf="selectedDepartmentName">
    <div class="p-6 border-b border-gray-200 flex justify-between items-center">
      <div class="flex items-center gap-2">
        <lucide-icon name="users" class="text-blue-600 w-6 h-6"></lucide-icon>
        <div>
          <h2 class="text-xl font-semibold text-gray-800">Staff Members</h2>
          <p class="text-sm text-gray-500">Department: {{selectedDepartmentName}}</p>
        </div>
      </div>
      <div class="flex items-center gap-4 flex-grow max-w-md mx-8">
        <div class="relative w-full">
          <lucide-icon name="search"
            class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"></lucide-icon>
          <input [(ngModel)]="searchTerm" (ngModelChange)="filterStaffs()" placeholder="Search staff..."
            class="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
        </div>
      </div>

      <button (click)="isAddingNew = true" [disabled]="isAddingNew"
        class="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 transition-colors">
        <lucide-icon name="plus" class="w-4 h-4"></lucide-icon>
        <span>Add Staff</span>
      </button>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-gray-50 border-b">
          <tr>
            <th (click)="toggleSort('Id')"
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 transition-colors">
              <div class="flex items-center gap-1">
                ID <lucide-icon *ngIf="sortColumn === 'Id'"
                  [name]="sortDirection === 'asc' ? 'chevron-up' : 'chevron-down'" class="w-3 h-3"></lucide-icon>
              </div>
            </th>
            <th (click)="toggleSort('StaffCode')"
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 transition-colors">
              <div class="flex items-center gap-1">
                Code <lucide-icon *ngIf="sortColumn === 'StaffCode'"
                  [name]="sortDirection === 'asc' ? 'chevron-up' : 'chevron-down'" class="w-3 h-3"></lucide-icon>
              </div>
            </th>
            <th (click)="toggleSort('StaffName')"
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 transition-colors">
              <div class="flex items-center gap-1">
                Name <lucide-icon *ngIf="sortColumn === 'StaffName'"
                  [name]="sortDirection === 'asc' ? 'chevron-up' : 'chevron-down'" class="w-3 h-3"></lucide-icon>
              </div>
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Created</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Modified</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let staff of filteredStaffs" class="hover:bg-gray-50">
            <td class="px-6 py-4 text-sm">{{staff.Id}}</td>

            <td class="px-6 py-4 text-sm">
              <input *ngIf="editingId === staff.Id" [(ngModel)]="editingData.StaffCode"
                (click)="$event.stopPropagation()" class="border rounded px-2 py-1 w-full">
              <span *ngIf="editingId !== staff.Id">{{staff.StaffCode}}</span>
            </td>

            <td class="px-6 py-4 text-sm">
              <input *ngIf="editingId === staff.Id" [(ngModel)]="editingData.StaffName"
                (click)="$event.stopPropagation()" class="border rounded px-2 py-1 w-full">
              <span *ngIf="editingId !== staff.Id">{{staff.StaffName}}</span>
            </td>

            <td class="px-6 py-4 text-sm text-gray-500">{{staff.dataCreatedOn | date:'mediumDate'}}</td>
            <td class="px-6 py-4 text-sm text-gray-500">{{staff.datamodifiedOn | date:'mediumDate'}}</td>

            <td class="px-6 py-4 text-sm">
              <div class="flex gap-2" (click)="$event.stopPropagation()">
                <ng-container *ngIf="editingId === staff.Id; else viewMode">
                  <button (click)="handleSave(staff.Id)"
                    class="p-1 text-green-600 hover:bg-green-50 rounded transition-colors" title="Save">
                    <lucide-icon name="save" class="w-5 h-5"></lucide-icon>
                  </button>
                  <button (click)="handleCancel()" class="p-1 text-gray-600 hover:bg-gray-50 rounded transition-colors"
                    title="Cancel">
                    <lucide-icon name="rotate-ccw" class="w-5 h-5"></lucide-icon>
                  </button>
                </ng-container>
                <ng-template #viewMode>
                  <button (click)="handleEdit(staff)" [disabled]="isAddingNew || editingId"
                    class="p-1 text-blue-600 hover:bg-blue-50 rounded disabled:text-gray-300 transition-colors"
                    title="Edit">
                    <lucide-icon name="edit" class="w-5 h-5"></lucide-icon>
                  </button>
                  <button (click)="handleDelete(staff.Id)" [disabled]="isAddingNew || editingId"
                    class="p-1 text-red-600 hover:bg-red-50 rounded disabled:text-gray-300 transition-colors"
                    title="Delete">
                    <lucide-icon name="trash-2" class="w-5 h-5"></lucide-icon>
                  </button>
                </ng-template>
              </div>
            </td>
          </tr>

          <tr *ngIf="isAddingNew" class="bg-green-50">
            <td></td>
            <td><input [(ngModel)]="newStaff.StaffCode" placeholder="Code" class="border rounded px-2 py-1 w-full"></td>
            <td><input [(ngModel)]="newStaff.StaffName" placeholder="Name" class="border rounded px-2 py-1 w-full"></td>
            <td class="px-6 py-4 text-sm">-</td>
            <td class="px-6 py-4 text-sm">-</td>
            <td class="px-6 py-4 text-sm">
              <div class="flex gap-2">
                <button (click)="handleSaveNew()" class="p-1 text-green-600 hover:bg-white rounded transition-colors"
                  title="Save">
                  <lucide-icon name="check" class="w-6 h-6"></lucide-icon>
                </button>
                <button (click)="isAddingNew = false" class="p-1 text-gray-600 hover:bg-white rounded transition-colors"
                  title="Cancel">
                  <lucide-icon name="x" class="w-6 h-6"></lucide-icon>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>