<div class="bg-white rounded-lg shadow">
  <div class="p-6 border-b border-gray-200 flex justify-between items-center">
    <div class="flex items-center gap-2">
      <lucide-icon name="building-2" class="text-blue-600 w-6 h-6"></lucide-icon>
      <h2 class="text-xl font-semibold text-gray-800">Departments</h2>
    </div>
    <button (click)="isAddingNew = true; editingId = null" [disabled]="isAddingNew || editingId !== null"
      class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors">
      <lucide-icon name="plus" class="w-4 h-4"></lucide-icon>
      <span>Add Department</span>
    </button>
  </div>

  <div class="overflow-x-auto">
    <table class="w-full">
      <thead class="bg-gray-50 border-b border-gray-200">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Code</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Created</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Modified</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <tr *ngFor="let dept of departments" (click)="handleRowClick(dept)"
          [ngClass]="{'bg-blue-50': selectedDepartmentId === dept.Id, 'hover:bg-gray-50': true, 'cursor-pointer': editingId === null && !isAddingNew}">

          <td class="px-6 py-4 text-sm text-gray-900">{{dept.Id}}</td>

          <td class="px-6 py-4 text-sm">
            <input *ngIf="editingId === dept.Id" [(ngModel)]="editingData.DepartmentCode"
              (click)="$event.stopPropagation()" class="border rounded px-2 py-1 w-full">
            <span *ngIf="editingId !== dept.Id">{{dept.DepartmentCode}}</span>
          </td>

          <td class="px-6 py-4 text-sm">
            <input *ngIf="editingId === dept.Id" [(ngModel)]="editingData.DepartmentName"
              (click)="$event.stopPropagation()" class="border rounded px-2 py-1 w-full">
            <span *ngIf="editingId !== dept.Id">{{dept.DepartmentName}}</span>
          </td>

          <td class="px-6 py-4 text-sm text-gray-500">{{dept.dataCreatedOn | date:'mediumDate'}}</td>
          <td class="px-6 py-4 text-sm text-gray-500">{{dept.datamodifiedOn | date:'mediumDate'}}</td>

          <td class="px-6 py-4 text-sm">
            <div class="flex gap-2" (click)="$event.stopPropagation()">
              <ng-container *ngIf="editingId === dept.Id; else viewMode">
                <button (click)="handleSave(dept.Id)"
                  class="p-1 text-green-600 hover:bg-green-50 rounded transition-colors" title="Save">
                  <lucide-icon name="save" class="w-5 h-5"></lucide-icon>
                </button>
                <button (click)="editingId = null" class="p-1 text-gray-600 hover:bg-gray-50 rounded transition-colors"
                  title="Cancel">
                  <lucide-icon name="rotate-ccw" class="w-5 h-5"></lucide-icon>
                </button>
              </ng-container>
              <ng-template #viewMode>
                <button (click)="handleEdit(dept, $event)" [disabled]="isAddingNew || editingId"
                  class="p-1 text-blue-600 hover:bg-blue-50 rounded disabled:text-gray-300 transition-colors"
                  title="Edit">
                  <lucide-icon name="edit" class="w-5 h-5"></lucide-icon>
                </button>
                <button (click)="handleDelete(dept.Id, $event)" [disabled]="isAddingNew || editingId"
                  class="p-1 text-red-600 hover:bg-red-50 rounded disabled:text-gray-300 transition-colors"
                  title="Delete">
                  <lucide-icon name="trash-2" class="w-5 h-5"></lucide-icon>
                </button>
              </ng-template>
            </div>
          </td>
        </tr>

        <tr *ngIf="isAddingNew" class="bg-green-50">
          <td class="px-6 py-4 text-sm">New</td>
          <td class="px-6 py-4 text-sm"><input [(ngModel)]="newDepartment.DepartmentCode" placeholder="Code"
              class="border rounded px-2 py-1 w-full"></td>
          <td class="px-6 py-4 text-sm"><input [(ngModel)]="newDepartment.DepartmentName" placeholder="Name"
              class="border rounded px-2 py-1 w-full"></td>
          <td class="px-6 py-4 text-sm">-</td>
          <td class="px-6 py-4 text-sm">-</td>
          <td class="px-6 py-4 text-sm">
            <div class="flex gap-2">
              <button (click)="handleSaveNew()" class="p-1 text-green-600 hover:bg-white rounded transition-colors"
                title="Save">
                <lucide-icon name="check" class="w-6 h-6"></lucide-icon>
              </button>
              <button (click)="isAddingNew = false" class="p-1 text-gray-600 hover:bg-white rounded transition-colors"
                title="Cancel">
                <lucide-icon name="x" class="w-6 h-6"></lucide-icon>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>